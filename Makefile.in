# ============================================
# $id: Makefile.in,v 1.14 2002/01/04 16:04:35 eric Exp $
# ============================================
PACKAGE = @PACKAGE@
VERSION = @VERSION@
utildir=@PUBRULE@
appname = @APPNAME@
pubdir = @prefix@
srcdir = @srcdir@
rootprefix=$(RPM_BUILD_ROOT)


export pubdir utildir appname pidir

TAR = gtar
GZIP_ENV = --best



export targetdir
export utildir

SUBDIR= Admin Expire Class Action Zone Share App Api Images Style Doc debian

TOP_MODULES =  index.php.q wsh.php wvirtual.php wchoose.php guest.php apache.conf  whattext wcheck wstop wstart wdbcreate winitrc apachev.conf.in apachevi.conf.in httpd.pam.in httpdwa.pam.in resizeimg.php libutil.sh wcontrol wcontrol.xml index.php


include $(utildir)/PubRule

DISTFILES += $(SUBDIR)  \
             ChangeLog  VERSION RELEASE WHAT.cron \
	     whattext wcheck wstop wstart wdbcreate winitrc httpd.pam.in httpdwa.pam.in guest.php index.php index.php.q freedom.conf.in dbaccess.php.sample.in libutil.sh wcontrol wcontrol.xml



$(pubdir)/index.php.q: index.php.q
	cp $< $@
$(pubdir)/index.php: index.php
	cp $< $@
$(pubdir)/whattext: whattext
	cp $< $@
$(pubdir)/wcheck: wcheck
	cp $< $@
$(pubdir)/wdbcreate: wdbcreate
	cp $< $@
$(pubdir)/winitrc: winitrc
	cp $< $@
$(pubdir)/wstop: wstop
	cp $< $@
$(pubdir)/wstart: wstart
	cp $< $@
$(pubdir)/httpd.pam.in: httpd.pam.in
	cp $< $@
$(pubdir)/httpdwa.pam.in: httpdwa.pam.in
	cp $< $@
$(pubdir)/apachev.conf.in: apachev.conf.in
	cp $< $@
$(pubdir)/apachevi.conf.in: apachevi.conf.in
	cp $< $@
$(pubdir)/libutil.sh: libutil.sh
	cp $< $@
$(pubdir)/wcontrol: wcontrol
	cp $< $@
$(pubdir)/wcontrol.xml: wcontrol.xml
	cp $< $@


$(pubdir)/admin:
	mkdir -p $@
$(rootprefix)/etc/pam.d:
	mkdir -p $@
$(rootprefix)/etc/pam.d/httpd.freedom.sample: $(rootprefix)/etc/pam.d
	cp httpd.pam $@
$(rootprefix)/etc/pam.d/httpdwa.freedom.sample: $(rootprefix)/etc/pam.d
	cp httpdwa.pam $@
$(rootprefix)/etc/freedom.conf: 
	cp freedom.conf $@

$(rootprefix)/etc/cron.daily:
	mkdir -p $@

$(rootprefix)/etc/cron.daily/WHAT.cron:WHAT.cron $(rootprefix)/etc/cron.daily
	cp WHAT.cron $@

$(pubdir)/FDLGEN:
	mkdir -p $@
$(pubdir)/FDLGEN/default: $(pubdir)/FDLGEN
	ln -sf ../context/default/FDLGEN $@
$(pubdir)/context/default/FDLGEN:
	mkdir -p $@
$(pubdir)/context/default/dbaccess.php.sample: dbaccess.php.sample $(pubdir)/context/default/FDLGEN $(pubdir)/FDLGEN/default
	cp $< $@

publish: $(rootprefix)/etc/pam.d/httpd.freedom.sample $(rootprefix)/etc/pam.d/httpdwa.freedom.sample $(rootprefix)/etc/cron.daily/WHAT.cron $(rootprefix)/etc/freedom.conf $(pubdir)/context/default/dbaccess.php.sample

clean:
	rm -f *.*~ config.* Makefile configure $(PACKAGE).spec \
	      $(PACKAGE)-Fedora.spec $(PACKAGE)-$(VERSION).tar.gz \
	      dbaccess.php.sample apache.conf App/Core/CORE_init.php \
	      App/Users/USERS_init.php App/Access/ACCESS_init.php \
	      App/Authent/AUTHENT_init.php App/Appmng/APPMNG_init.php \
	      httpd.pam \
	      Api/updateclass.php
