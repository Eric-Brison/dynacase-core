#!/bin/bash
if [ "$freedom_context" == "" ]; then
  . /etc/freedom.conf
   wchoose -b
fi

if [ -f $wpub/maintenance.lock ]; then
    /bin/rm $wpub/maintenance.lock
fi

# link images file to be used in several applications
if [ ! -d $wpub/Images ] ; then
    mkdir $wpub/Images
fi
if [ ! -d $wpub/Docs ] ; then
    mkdir $wpub/Docs
fi
pushd $wpub/Images > /dev/null
ln -sf ../*/Images/* .
popd > /dev/null

pushd $wpub/Docs > /dev/null
ln -sf ../*/Docs/* .
popd > /dev/null
#refresh version identificator
$wpub/wsh.php --api=refreshjsversion >/dev/null
#clear current sessions
PGSERVICE="$pgservice_core" psql -c "delete from sessions where name='freedom_param'" > /dev/null

#change pg mode connection
cdb=`$wpub/wsh.php --api=get_param --param=CORE_DBCONNECT`
if [ $cdb == 'persistent' ] ; then
  sed -ibak -e"s/pg_connect/pg_pconnect/g" $wpub/WHAT/Lib.Common.php
else
  sed -ibak -e"s/pg_pconnect/pg_connect/g" $wpub/WHAT/Lib.Common.php
fi

#/bin/rm -f /var/run/php/sess_*
#/bin/rm -f /var/lib/php/session/sess_*

