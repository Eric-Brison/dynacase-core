#!/bin/bash

if [ -z "$pgservice_core" ]; then
	echo "Undefined or empty pgservice_core!"
	exit 1
fi

PGSERVICE="$pgservice_core" psql --set ON_ERROR_STOP=on -f - <<'EOF'
update doc set name=docread.name
from docread
where
docread.name is not null and
doc.name is null and
doc.initid = docread.initid and
doc.doctype != 'Z' and
docread.locked != -1
and not exists (select initid from doc where doc.initid=docread.initid group by revision, initid having count(revision) > 1);
EOF
RET=$?
if [ $RET -ne 0 ]; then
    echo "Error reset revised logical name."
    exit $RET
fi

